pipeline {
    agent any
tools{
        maven 'Maven'
    }

  parameters {
        choice(name: 'TEST_TYPE', choices: ['smoke', 'regression'], description: 'Choose test type to run')
    }
stages
	{
	stage("Build")
	{
	steps{
		echo "building the project......................................"
script{
	bat "mvn clean package"
	}
	      }}

	stage("Test")
	{
	steps{
		echo "testing the project......................................."
script {
                    def suiteXmlFile = "smoke.xml"
                    
                    if (params.TEST_TYPE == 'Regression') {
                        suiteXmlFile = "regression.xml"
                    }
                    
                    bat "mvn clean test -DsuiteXmlFile=${suiteXmlFile}"
                }
	}}
   }

post {
    failure {
            emailext body: "failed tests. Please go to console",
	    attachLog: false,
            attachmentsPattern: 'target/surefire-reports/OrionApiSmokeTests.html',
           subject: "${env.JOB_NAME}-Build # ${env.BUILD_NUMBER}--Successful",
           mimeType: 'text/html',
           to: "mammadli.javid15@gmail.com"
    }
    success {
           emailext body: "Success, see CONSOLE",
	   attachLog: false,
           attachmentsPattern: 'target/surefire-reports/OrionApiSmokeTests.html',
           subject: "${env.JOB_NAME}-Build # ${env.BUILD_NUMBER}--Successful",
           mimeType: 'text/html',
           to: "mammadli.javid15@gmail.com"
    }
}
}
