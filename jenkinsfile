pipeline {
    agent any
tools{
        maven 'Maven'
    }
stages
	{
	stage("Build")
	{
	steps{
		echo "building the project......."
script{
	bat "mvn clean package"
	}
	      }}

	stage("Test")
	{
	steps{
		echo "testing the project......."
script{
	bat "mvn clean test -DsuiteXmlFile=suite.xml"
	}
	}}
   }

post {
    failure {
            emailext body: "failed tests. Please go to console",
	    attachLog: false,
            attachmentsPattern: 'target/surefire-reports/smokeSuite/ILOTApplicationSmokeTests.html',
	   subject: "Failed",
           mimeType: 'text/html',
           to: "mamadli.javid@gmail.com"
    }
    success {
           emailext body: "Success, see CONSOLE",
	   attachLog: false,
           attachmentsPattern: 'target/surefire-reports/smokeSuite/ILOTApplicationSmokeTests.html',
           subject: "${env.JOB_NAME}-Build # ${env.BUILD_NUMBER}--Successful",
           mimeType: 'text/html',
           to: "mamadli.javid@gmail.com"
    }
}
}
